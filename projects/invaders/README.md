# Space Invaders Game

Raspberry Pi Pico用のスペースインベーダーゲームです。ST7735 TFTディスプレイとボタンコントロールを使用したクラシックなシューティングゲームの実装です。

## 機能

- **クラシックなゲームプレイ**: 5列×4行の敵編隊を撃破
- **プレイヤー操作**: 左右移動と弾発射
- **敵AI**: 横移動、下降、ランダムな弾発射
- **衝突検出**: プレイヤーの弾と敵、敵の弾とプレイヤー
- **スコアシステム**: 敵を倒すと10点獲得
- **効果音**: PWMブザーによる弾発射音、撃破音、ゲームオーバー音
- **ゲーム制御**: 一時停止とリスタート機能

## ハードウェア要件

### ディスプレイ
- ST7735S 128×160 TFT LCD
- SPI接続

### ボタン
- 左ボタン (GPIO 21)
- 右ボタン (GPIO 27)
- Aボタン/発射 (GPIO 28)
- STARTボタン (GPIO 11)

### サウンド
- PWMブザー (GPIO 0)

### ピン配置
```
SPI0:
- SCK:  GPIO 2
- MOSI: GPIO 3
- MISO: GPIO 4
- CS:   GPIO 5
- DC:   GPIO 6
- RST:  GPIO 7
```

詳細なハードウェア構成は [HARDWARE.md](../../HARDWARE.md) を参照してください。

## ゲーム操作

| ボタン | 機能 |
|--------|------|
| 左ボタン | プレイヤーを左に移動 |
| 右ボタン | プレイヤーを右に移動 |
| Aボタン | 弾を発射（最大3発同時） |
| STARTボタン | ゲーム開始/一時停止/リスタート |

## ゲームルール

1. **目的**: すべての敵を撃破する
2. **操作**: 左右ボタンで移動、Aボタンで弾を発射
3. **敵の動き**: 
   - 横に移動しながら下降
   - ランダムに弾を発射
4. **敗北条件**:
   - 敵の弾に当たる
   - 敵が画面下部に到達
5. **勝利条件**: すべての敵を撃破

## スコアリング

- 敵を撃破: +10点

## ゲーム仕様

### 画面サイズ
- 128×160 ピクセル

### スプライトサイズ
- プレイヤー: 8×6 ピクセル
- 敵: 8×8 ピクセル
- 弾: 2×4 ピクセル

### 色使用 (RGB565)
- 背景: 黒 (0x0000)
- プレイヤー: 緑 (0x07E0)
- 敵: 赤 (0xF800)
- 弾: 白 (0xFFFF)
- テキスト: 黄 (0xFFE0)

### パフォーマンス
- ターゲットフレームレート: 30 FPS
- メモリ効率を考慮した設計
- 定期的なガベージコレクション

## ファイル構成

```
projects/invaders/
├── main.py         # エントリーポイント
├── invaders.py     # メインゲームロジック
├── st7735.py       # ディスプレイドライバ
└── README.md       # このファイル
```

## インストール方法

1. MicroPythonファームウェアをRaspberry Pi Picoにインストール
2. プロジェクトファイルをPicoにアップロード:
   ```
   projects/invaders/main.py
   projects/invaders/invaders.py
   projects/invaders/st7735.py
   ```
3. Picoをリセットするとゲームが自動起動

## 実行方法

### 方法1: 自動起動
プロジェクトディレクトリの`main.py`をPicoのルートディレクトリにコピーすると、起動時に自動実行されます。

### 方法2: REPLから実行
```python
import sys
sys.path.append('/projects/invaders')
from main import *
```

## 開発情報

### 主要クラス

#### `SpaceInvaders`
メインゲームクラス。初期化、ゲームループ、描画を管理。

#### `Player`
プレイヤーの移動、弾発射、描画を処理。

#### `Enemy`
個別の敵キャラクターを表現。

#### `EnemyFormation`
敵編隊全体の動き、弾発射、衝突判定を管理。

#### `Bullet`
プレイヤーと敵の弾を表現。

### メモリ最適化

- リスト内包表記の使用
- 非アクティブなオブジェクトの定期的な削除
- ガベージコレクションの定期実行
- 効率的なスプライト描画

## カスタマイズ

### 難易度調整

[`invaders.py`](invaders.py:38) の定数を変更:

```python
# 敵の移動速度を変更
ENEMY_MOVE_SPEED = 1  # 大きいほど速い

# 敵の発射頻度を変更
ENEMY_SHOOT_CHANCE = 0.002  # 大きいほど頻繁

# 敵の移動間隔を変更
self.move_interval = 30  # 小さいほど速く動く
```

### スコアリング変更

[`invaders.py`](invaders.py:294) の衝突判定部分:

```python
self.score += 10  # この値を変更
```

## トラブルシューティング

### ディスプレイが表示されない
- SPI配線を確認
- `bgr=True`パラメータが設定されているか確認
- ディスプレイの電源を確認

### ボタンが反応しない
- プルアップ抵抗が有効か確認
- GPIO番号が正しいか確認
- ボタンの配線を確認

### 動作が遅い
- フレームレート設定を確認
- メモリ使用量を確認（`gc.mem_free()`で確認）

## ライセンス

このプロジェクトは教育目的で作成されています。

## 参考資料

- [MicroPython ドキュメント](https://docs.micropython.org/)
- [Raspberry Pi Pico ドキュメント](https://www.raspberrypi.com/documentation/microcontrollers/)
- [ST7735 データシート](https://www.displayfuture.com/Display/datasheet/controller/ST7735.pdf)